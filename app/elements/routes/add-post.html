<dom-module id="add-post">
    <template>
        <paper-material elevation="1">

            <auth-fetch id="fetch" url="/api/nodes" params="{{params}}" last-json="{{lastJson}}"></auth-fetch>

            <paper-input title="Title" value="{{title}}"></paper-input>

            <iron-autogrow-textarea value="{{text}}"></iron-autogrow-textarea>

            <render-remarkable input="{{text}}"></render-remarkable>

            <paper-button raised on-tap="createPost">create</paper-button>
        </paper-material>
    </template>
    <script>
        Polymer({
            is: "add-post",
            properties: {
                title: {
                    type: String,
                    notify: true
                },
                text: {
                    type: String,
                    notify: true
                },
                params: {
                    type: Object,
                    notify: true
                },
                lastJson: {
                    type: Object,
                    notify: true,

                }
            },
            createPost: function () {
                console.log(this.title, this.text);
                var body = {
                    kind: "Post",
                    title: this.title
                };
                if(!!this.text) {
                    body.text = {
                        content: this.text,
                        version: 1
                    }
                }
                this.params = {
                    method: "POST",
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(body)
                };
                this.$.fetch.generateRequest();
            }
        })
    </script>
</dom-module>