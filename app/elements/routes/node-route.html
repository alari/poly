<dom-module id="node-route">
  <style>
    paper-material {
      background-color: white;
      min-height: 120px;
      max-width: 720px;
      margin: 0px auto;
    }

    :host .container {
      padding: 2em;
    }
  </style>
  <template>
    <meta-route load href="{{nodeHref}}" expand="user,text" meta-response="{{node}}">

      <page-info title="{{node.title}}"></page-info>

      <paper-material elevation="1">
        <div class="container">

          <h1>{{node.title}}</h1>

          <meta-resource model="{{node.text}}">
            <div>
              <render-remarkable input="{{node.text.content}}"></render-remarkable>
            </div>
            <div>
              <a href$="{{userHref}}">{{node.user.name}}</a>
            </div>
          </meta-resource>

          <div>
            <is-auth user="{{node.user}}">
              <a href$="{{nodeEditHref}}">Редактировать</a>
            </is-auth>
          </div>
        </div>
      </paper-material>

    </meta-route>
  </template>
  <script>
    Polymer({
      is: "node-route",

      properties: {
        routeParams: {
          type: Object,
          notify: true
        },
        node: {
          type: Object,
          notify: true
        },
        nodeHref: {
          computed: "computeNodeHref(routeParams)"
        },
        userHref: {
          computed: "computeUserHref(node)"
        },
        nodeEditHref: {
          computed: "computeNodeEditHref(routeParams)"
        }
      },

      computeNodeHref: function (routeParams) {
        return "/api/nodes/" + routeParams.name;
      },

      computeUserHref: function (node) {
        if(node && node.user) {
          return "/user/" + node.user.id;
        } else {
          return "/user/";
        }
      },

      computeNodeEditHref: function (routeParams) {
        return "/nodes/" + routeParams.name + "/edit";
      }
    });
  </script>
</dom-module>