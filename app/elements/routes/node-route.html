<dom-module id="node-route">
  <style>
    paper-material {
      background-color: white;
      min-height: 120px;
      max-width: 720px;
      margin: 0px auto;
    }
    :host .container {
      padding: 2em;
    }
  </style>
  <template>
    <meta-route load href="{{nodeHref}}" expand="user,text" meta-response="{{node}}">

      <meta-resource model="{{node}}">
        <paper-material elevation="1">
          <div class="container">

            <h1>{{node.title}}</h1>

            <meta-resource model="{{node.text}}">
            <div>
              <render-remarkable input="{{node.text.content}}"></render-remarkable>
            </div>
            </meta-resource>

            <div>
              <is-auth user="{{node.user}}">
                <a href$="{{nodeEditHref}}">Редактировать</a>
              </is-auth>
            </div>
          </div>
        </paper-material>
      </meta-resource>

    </meta-route>
  </template>
  <script>
    Polymer({
      is: "node-route",

      properties: {
        params: {
          type: Object,
          notify: true
        },
        node: {
          type: Object,
          notify: true
        },
        nodeHref: {
          computed: "computeNodeHref(params)"
        },
        nodeEditHref: {
          computed: "computeNodeEditHref(params)"
        }
      },

      observers: [
        "_nodeLoad(lastJson)"
      ],

      attached: function () {
        console.log("node route attached, params = ", this.params);
      },

      computeNodeHref: function (params) {
        return "/api/nodes/" + params.name;
      },

      computeNodeEditHref: function (params) {
        return "/nodes/" + params.name + "/edit";
      },

      _nodeLoad: function (lastJson) {
        if (!!lastJson && lastJson.title) {
          document.title = lastJson.title;
        }
      }
    })
  </script>
</dom-module>