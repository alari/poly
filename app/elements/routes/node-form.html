<dom-module id="node-form">
  <style>
    paper-material {
      background-color: white;
      min-height: 120px;
      max-width: 720px;
      margin: auto;
    }

    :host .container {
      padding: 2em;
    }

    iron-autogrow-textarea {
      width: 100%;
      padding: 2em;
      border: 0;
      min-height: 200px;
    }
  </style>
  <template>
    <meta-route id="route" href="/api/nodes" meta-response="{{node}}" load="false">
      <meta-resource model="{{node}}">

        <paper-material elevation="1">

          <paper-input title="Title" placeholder="Название" value="{{node.title}}" on-input="_setTitle"></paper-input>

          <meta-resource model="{{node.text}}">
            <iron-autogrow-textarea placeholder="Текст" bind-value="{{node.text.content}}"></iron-autogrow-textarea>
          </meta-resource>

          <meta-button on-complete="_saved">
            <paper-button raised>Сохранить</paper-button>
          </meta-button>
        </paper-material>
      </meta-resource>
    </meta-route>

  </template>
  <script>
    Polymer({
      is: "node-form",
      properties: {
        node: {
          type: Object,
          notify: true,
          value: {
            kind: "Post",
            title: "",
            text: {
              content: "",
              version: 1
            }
          }
        },
        params: {
          type: Object,
          notify: true
        },
        saving: {
          type: Boolean,
          default: false
        }
      },
      observers: [
        "_setTitle(node)",
        "_params(params)"
      ],
      _setTitle: function (node) {
        document.title = (this.node && this.node.title) || "Add Post";
        this.notifyPath("node.title", this.node.title);
        this.notifyPath("node.text.content", this.node.text.content);
      },
      _params: function (params) {
        if (params && params.name) {
          this.$.route.href = "/api/nodes/" + params.name + "?expand=text";
          this.$.route.load = true;
        }
      },
      _saved: function (e) {
        if (e.detail && e.detail.id) {
          page("/nodes/" + e.detail.id);
        }
      }
    })
  </script>
</dom-module>