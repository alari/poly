<dom-module id="render-remarkable">

  <script src="../../../bower_components/remarkable/dist/remarkable.js"></script>

  <template>
    <div id="output"></div>
  </template>

  <script>
    (function () {
      "use strict";

      var md = new Remarkable('full', {
        html: false,        // Enable HTML tags in source
        xhtmlOut: false,        // Use '/' to close single tags (<br />)
        breaks: true,        // Convert '\n' in paragraphs into <br>
        langPrefix: 'language-',  // CSS language prefix for fenced blocks
        linkify: true,         // autoconvert URL-like texts to links

        // Enable some language-neutral replacements + quotes beautification
        typographer: true,

        // Double + single quotes replacement pairs, when typographer enabled,
        // and smartquotes on. Set doubles to '«»' for Russian, '„“' for German.
        quotes: '«»‘’',

        // Highlighter function. Should return escaped HTML,
        // or '' if input not changed
        highlight: function (str, lang) {
          if (lang && hljs.getLanguage(lang)) {
            try {
              return hljs.highlight(lang, str).value;
            } catch (__) {
            }
          }

          try {
            return hljs.highlightAuto(str).value;
          } catch (__) {
          }

          return ''; // use external default escaping
        }
      });

      new Polymer({
        is: "render-remarkable",
        properties: {
          input: {
            type: String,
            notify: true
          }
        },
        listeners: {
          'input-changed': 'inputChanged'
        },
        render: function () {
          this.$.output.innerHTML = md.render(this.input);
        },
        inputChanged: function (v) {
          this.render();
        },
        attached: function () {
          this.render();
        }
      });
    })();
  </script>
</dom-module>