<link rel="import" href="../../bower_components/gold-email-input/gold-email-input.html">

<dom-module id="auth-signup">

  <style>
    #dialog {
      border-color: var(--paper-orange-500);
      background-color: var(--paper-orange-50);
      color: var(--paper-orange-500);
    }
    .error {
      color: var(--paper-red-500);
      text-align: center;
    }
  </style>

  <template>

      <paper-dialog id="dialog">
        <h2>Регистрация</h2>

        <gold-email-input label="Email" value="{{email}}" required autofocus id="email" on-blur="checkEmailAvailable" auto-validate></gold-email-input>
        <paper-input label="Пароль" value="{{password}}" type="password" required></paper-input>

        <div hidden$="{{!error}}" class="error">
          <span>{{error}}</span>
        </div>

        <div class="buttons">
          <meta-button update-model method="PUT" body="{{ signupBody(email, emailVerify, password) }}" on-complete="complete">
            <paper-button>Создать аккаунт</paper-button>
          </meta-button>
        </div>
      </paper-dialog>

  </template>
  <script>
    (function () {
      "use strict";
      Polymer({
        is: "auth-signup",
        properties: {
          email: {
            type: String,
            value: null,
            notify: true
          },
          password: {
            type: String,
            value: null,
            notify: true
          },
          failure: {
            type: Object,
            notify: true
          }
        },

        complete: function(m) {
          if(!!m.detail.failure) {
            this.error = m.detail.failure.summary;
          }
        },

        signupBody: function() {
          return {
            provider: "email",
            email: this.email,
            password: this.password
          };
        },

        toggle: function() {
          this.$.dialog.toggle();
        },

        close: function() {
          this.$.dialog.close();
          this.email = null;
          this.password = null;
        },

        open: function() {
          this.$.dialog.open();
        },

        checkEmailAvailable: function () {
          if (this.email) {
            return true;
          }
        }
      });
    })();
  </script>
</dom-module>